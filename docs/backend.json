{
  "entities": {
    "Professor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Professor",
      "type": "object",
      "description": "Represents a professor within the UNDB system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Professor entity."
        },
        "email": {
          "type": "string",
          "description": "The professor's UNDB email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The professor's full name."
        },
        "registrationDate": {
          "type": "string",
          "description": "The date the professor registered in the system.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "name",
        "registrationDate"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course offered at UNDB.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "professorId": {
          "type": "string",
          "description": "Reference to Professor. (Relationship: Professor 1:N Course)"
        },
        "name": {
          "type": "string",
          "description": "The name of the course."
        },
        "code": {
          "type": "string",
          "description": "The course code (e.g., MAT101)."
        },
        "syllabus": {
          "type": "string",
          "description": "The course syllabus content."
        },
        "objectives": {
          "type": "string",
          "description": "The objectives of the course."
        },
        "competencies": {
          "type": "string",
          "description": "The competencies of the course."
        },
        "thematicTree": {
          "type": "array",
          "description": "The thematic tree of the course.",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "description": { "type": "string" }
            },
            "required": ["name", "description"]
          }
        },
        "bibliography": {
          "type": "object",
          "description": "The bibliography of the course, separated into sections.",
          "properties": {
              "basic": { "type": "string", "description": "Basic bibliography." },
              "complementary": { "type": "string", "description": "Complementary bibliography." },
              "recommended": { "type": "string", "description": "Recommended bibliography." }
          }
        }
      },
      "required": [
        "id",
        "professorId",
        "name",
        "code",
        "syllabus",
        "objectives"
      ]
    },
    "Classroom": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Classroom",
      "type": "object",
      "description": "Represents a specific class group for a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Classroom entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Classroom)"
        },
        "name": {
          "type": "string",
          "description": "The name of the classroom (e.g., Class A)."
        },
        "semester": {
          "type": "string",
          "description": "The semester the classroom is active in."
        },
        "workload": {
          "type": "string",
          "description": "The workload of the course for this specific classroom."
        },
        "classType": {
          "type": "string",
          "description": "The type of class (e.g., Regular, Intensive)."
        },
        "gradingRule": {
          "type": "string",
          "description": "The grading rules for the classroom."
        }
      },
      "required": [
        "id",
        "courseId",
        "name",
        "semester"
      ]
    },
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student enrolled at UNDB.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Student entity."
        },
        "name": {
          "type": "string",
          "description": "The student's full name."
        },
        "email": {
          "type": "string",
          "description": "The student's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "email"
      ]
    },
    "ClassroomStudent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClassroomStudent",
      "type": "object",
      "description": "Represents the association between a classroom and a student (many-to-many relationship).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ClassroomStudent entity."
        },
        "classroomId": {
          "type": "string",
          "description": "Reference to Classroom. (Relationship: Classroom 1:N ClassroomStudent)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N ClassroomStudent)"
        },
        "groupId": {
            "type": ["string", "null"],
            "description": "Reference to the Group this student belongs to. (Relationship: Group 1:N ClassroomStudent)"
        },
        "grades": {
          "type": "array",
          "description": "An array of grades for the student in this classroom.",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "description": { "type": "string" },
              "score": { "type": "number" }
            },
            "required": ["id", "description", "score"]
          }
        }
      },
      "required": [
        "id",
        "classroomId",
        "studentId"
      ]
    },
     "Group": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Group",
      "type": "object",
      "description": "Represents a group of students within a classroom.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Group entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the group."
        },
        "classroomId": {
          "type": "string",
          "description": "Reference to Classroom. (Relationship: Classroom 1:N Group)"
        }
      },
      "required": [
        "id",
        "name",
        "classroomId"
      ]
    },
    "Document": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Document",
      "type": "object",
      "description": "Represents a document stored within the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Document entity."
        },
        "professorId": {
          "type": "string",
          "description": "Reference to Professor. (Relationship: Professor 1:N Document)"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Document).  Can be null if the document is not associated with a specific course."
        },
        "classroomId": {
          "type": "string",
          "description": "Reference to Classroom. (Relationship: Classroom 1:N Document). Can be null if the document is not associated with a specific classroom."
        },
        "name": {
          "type": "string",
          "description": "The name of the document."
        },
        "fileUrl": {
          "type": "string",
          "description": "The URL where the document is stored.",
          "format": "uri"
        },
        "documentType": {
          "type": "string",
          "description": "The type of the document (e.g., Report, Syllabus)."
        }
      },
      "required": [
        "id",
        "professorId",
        "name",
        "fileUrl",
        "documentType"
      ]
    },
    "AcademicEvent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AcademicEvent",
      "type": "object",
      "description": "Represents an event in the academic calendar.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AcademicEvent entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N AcademicEvent). Can be null if the event is not associated with a specific course."
        },
        "name": {
          "type": "string",
          "description": "The name of the event (e.g., Midterm Exam)."
        },
        "dateTime": {
          "type": "string",
          "description": "The date and time of the event.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the event."
        }
      },
      "required": [
        "id",
        "name",
        "dateTime",
        "description"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/professors/{professorId}",
        "definition": {
          "entityName": "Professor",
          "schema": {
            "$ref": "#/backend/entities/Professor"
          },
          "description": "Stores professor data.  Path-based ownership. professors/{professorId} where professorId is request.auth.uid",
          "params": [
            {
              "name": "professorId",
              "description": "The unique identifier of the professor, corresponding to the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/professors/{professorId}/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores course data owned by a specific professor. Includes denormalized 'professorId' for authorization independence.",
          "params": [
            {
              "name": "professorId",
              "description": "The unique identifier of the professor."
            },
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            }
          ]
        }
      },
      {
        "path": "/professors/{professorId}/courses/{courseId}/classrooms/{classroomId}",
        "definition": {
          "entityName": "Classroom",
          "schema": {
            "$ref": "#/backend/entities/Classroom"
          },
          "description": "Stores classroom data owned by a specific professor for a specific course. Includes denormalized 'professorId' and 'courseId' for authorization independence.",
          "params": [
            {
              "name": "professorId",
              "description": "The unique identifier of the professor."
            },
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            },
            {
              "name": "classroomId",
              "description": "The unique identifier of the classroom."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores student data. This collection is globally accessible, but create/update operations are restricted to admins or the student themselves.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier of the student."
            }
          ]
        }
      },
      {
        "path": "/professors/{professorId}/courses/{courseId}/classrooms/{classroomId}/classroomStudents/{classRoomStudentId}",
        "definition": {
          "entityName": "ClassroomStudent",
          "schema": {
            "$ref": "#/backend/entities/ClassroomStudent"
          },
          "description": "Represents the association between a classroom and a student. Includes denormalized 'professorId', 'courseId', and 'classroomId' for authorization independence.",
          "params": [
            {
              "name": "professorId",
              "description": "The unique identifier of the professor."
            },
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            },
            {
              "name": "classroomId",
              "description": "The unique identifier of the classroom."
            },
            {
              "name": "classRoomStudentId",
              "description": "The unique identifier of the classroomStudent."
            }
          ]
        }
      },
       {
        "path": "/professors/{professorId}/courses/{courseId}/classrooms/{classroomId}/groups/{groupId}",
        "definition": {
          "entityName": "Group",
          "schema": {
            "$ref": "#/backend/entities/Group"
          },
          "description": "Stores student groups within a classroom, owned by the professor.",
          "params": [
            {
              "name": "professorId",
              "description": "The unique identifier of the professor."
            },
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            },
            {
              "name": "classroomId",
              "description": "The unique identifier of the classroom."
            },
            {
              "name": "groupId",
              "description": "The unique identifier of the group."
            }
          ]
        }
      },
      {
        "path": "/professors/{professorId}/documents/{documentId}",
        "definition": {
          "entityName": "Document",
          "schema": {
            "$ref": "#/backend/entities/Document"
          },
          "description": "Stores documents associated with a professor. Includes denormalized 'professorId' for authorization independence.",
          "params": [
            {
              "name": "professorId",
              "description": "The unique identifier of the professor."
            },
            {
              "name": "documentId",
              "description": "The unique identifier of the document."
            }
          ]
        }
      },
      {
        "path": "/professors/{professorId}/courses/{courseId}/academicEvents/{academicEventId}",
        "definition": {
          "entityName": "AcademicEvent",
          "schema": {
            "$ref": "#/backend/entities/AcademicEvent"
          },
          "description": "Stores academic events associated with a specific course. Includes denormalized 'professorId' and 'courseId' for authorization independence.",
          "params": [
            {
              "name": "professorId",
              "description": "The unique identifier of the professor."
            },
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            },
            {
              "name": "academicEventId",
              "description": "The unique identifier of the academic event."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the UNDB ProfAssist application, focusing on secure access, efficient data management, and AI integration for lesson plan imports. Authorization Independence is achieved by structuring professor-owned data under their respective user IDs and by denormalizing the 'professorId' into subcollections where professor authorization is required. This eliminates the need for `get()` calls in security rules, enabling atomic operations. QAPs (Rules are not Filters) are supported through structural segregation and dedicated collections. User roles are implicitly managed via path-based ownership, and course/classroom associations are secured by including the relevant professorId in each document. The structure supports secure list operations by scoping data to specific professor's or courses. Explicit state modeling would be incorporated into fields like status to improve the clarity and maintainability. This design ensures that each collection maintains a homogeneous security posture, simplifying rules and enhancing debuggability."
  }
}
